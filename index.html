<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ToDo„É™„Çπ„Éà Pro - Focus Layout</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&family=Roboto:wght@400;500;700;900&family=JetBrains+Mono:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 
                        sans: ['Roboto', 'Noto Sans JP', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'] 
                    },
                    colors: {
                        google: {
                            blue: '#1a73e8', red: '#ea4335', yellow: '#fbbc04', green: '#34a853',
                            gray: '#f1f3f4', text: '#202124', textSec: '#5f6368', hover: '#f8f9fa',
                            selected: '#e8f0fe', selectedText: '#1967d2'
                        },
                        duo: {
                            green: '#58cc02', border: '#46a302', greenHighlight: '#89e219',
                            blue: '#1cb0f6', blueBorder: '#1899d6',
                            orange: '#ff9600', orangeBorder: '#cc7900',
                            pink: '#ff4b4b', pinkBorder: '#d42c2c',
                            gray: '#e5e5e5', lightGray: '#f7f7f7', text: '#4b4b4b',
                            gold: '#FFD700', silver: '#C0C0C0'
                        }
                    },
                    boxShadow: {
                        'card': '0 2px 0 0 #e5e5e5',
                        'duo': '0 4px 0 0 #e5e5e5',
                        'floating': '0 6px 16px 0 rgba(0,0,0,0.2)',
                        'glow': '0 0 15px rgba(255, 255, 255, 0.8)',
                    },
                    animation: {
                        'shimmer': 'shimmer 2s linear infinite',
                        'pulse-fast': 'pulse 0.8s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'bounce-soft': 'bounce-soft 2s infinite',
                        'toast-in': 'toast-in 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards',
                        'float-up': 'float-up 1s ease-out forwards',
                        'spring': 'spring 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
                        'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both',
                        'chest-open': 'chest-open 0.5s forwards',
                        'light-burst': 'light-burst 1s ease-out infinite',
                        'ignition': 'ignition 1.5s ease-out forwards',
                        'flame-grow': 'flame-grow 0.5s ease-out forwards',
                        'scale-in': 'scale-in 0.2s ease-out forwards',
                        'tech-slide': 'tech-slide 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'log-fade': 'log-fade 3s ease-out forwards',
                        'checkbox-pop': 'checkbox-pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
                        'bounce-hard': 'bounce-hard 0.5s infinite',
                    },
                    keyframes: {
                        shimmer: { '0%': { backgroundPosition: '-200% 0' }, '100%': { backgroundPosition: '200% 0' } },
                        'bounce-soft': { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } },
                        'bounce-hard': { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-20px) scale(1.1)' } },
                        'toast-in': { '0%': { transform: 'translate(-50%, 100%)', opacity: 0 }, '100%': { transform: 'translate(-50%, 0)', opacity: 1 } },
                        'float-up': { '0%': { transform: 'translateY(0) scale(1)', opacity: 1 }, '100%': { transform: 'translateY(-60px) scale(1.1)', opacity: 0 } },
                        'spring': { '0%': { transform: 'scale(1)' }, '50%': { transform: 'scale(0.95)' }, '100%': { transform: 'scale(1)' } },
                        'shake': { '10%, 90%': { transform: 'translate3d(-2px, 0, 0) rotate(-2deg)' }, '20%, 80%': { transform: 'translate3d(4px, 0, 0) rotate(4deg)' }, '30%, 50%, 70%': { transform: 'translate3d(-8px, 0, 0) rotate(-8deg)' }, '40%, 60%': { transform: 'translate3d(8px, 0, 0) rotate(8deg)' } },
                        'chest-open': { '0%': { transform: 'scale(1)' }, '50%': { transform: 'scale(1.2)' }, '100%': { transform: 'scale(0) opacity(0)' } },
                        'light-burst': { '0%': { transform: 'scale(1)', opacity: 0.5 }, '100%': { transform: 'scale(1.5)', opacity: 0 } },
                        'ignition': { '0%': { opacity: 0, transform: 'scale(0.8)' }, '20%': { opacity: 1, transform: 'scale(1.2)' }, '100%': { opacity: 0, transform: 'scale(2)' } },
                        'flame-grow': { '0%': { transform: 'scale(1)', color: '#e5e5e5' }, '50%': { transform: 'scale(1.5)', color: '#ff9600' }, '100%': { transform: 'scale(1)', color: '#ff9600' } },
                        'scale-in': { '0%': { transform: 'scale(0.8)', opacity: 0 }, '100%': { transform: 'scale(1)', opacity: 1 } },
                        'tech-slide': { '0%': { transform: 'translateX(-20px)', opacity: 0 }, '100%': { transform: 'translateX(0)', opacity: 1 } },
                        'log-fade': { '0%': { color: '#FFD700', transform: 'translateX(-10px)' }, '20%': { color: '#FFD700', transform: 'translateX(0)' }, '100%': { color: '#4b5563' } },
                        'checkbox-pop': { '0%': { transform: 'scale(1)' }, '50%': { transform: 'scale(1.5)' }, '100%': { transform: 'scale(1)' } }
                    }
                }
            }
        }
    </script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { font-family: 'Roboto', 'Noto Sans JP', sans-serif; -webkit-font-smoothing: antialiased; }
        @keyframes confetti-explode { 0% { transform: translate(0, 0) scale(1); opacity: 1; } 60% { opacity: 1; } 100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; } }
        @keyframes cherry-fall { 0% { transform: translate(0, 0) rotate(0deg); opacity: 1; } 100% { transform: translate(var(--tx), var(--ty)) rotate(720deg); opacity: 0; } }
        @keyframes confetti-rise { 0% { transform: translateX(0) translateY(0) rotate(0deg); opacity: 1; } 50% { opacity: 1; } 100% { transform: translateX(var(--random-x)) translateY(-100vh) rotate(var(--random-rotation)); opacity: 0; } }

        /* ‰∏≠ÊØíÊÄßMAXÂ†±ÈÖ¨„Ç∑„Çπ„ÉÜ„É†„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
        @keyframes near-miss-flash { 0% { opacity: 0; } 30% { opacity: 1; } 100% { opacity: 0; } }
        @keyframes reward-particle { 0% { transform: translate(0, 0); opacity: 1; } 100% { transform: translate(var(--vx), var(--vy)); opacity: 0; } }
        @keyframes reward-fall { 0% { transform: translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
        @keyframes big-flash { 0% { opacity: 0; } 20% { opacity: 1; } 100% { opacity: 0; } }
        @keyframes jackpot-flash { 0% { opacity: 0; } 30% { opacity: 1; } 100% { opacity: 0; } }
        @keyframes screen-shake { 0%, 100% { transform: translate(0, 0); } 10%, 30%, 50%, 70%, 90% { transform: translate(-5px, 5px); } 20%, 40%, 60%, 80% { transform: translate(5px, -5px); } }
        @keyframes jackpot-text { 0% { transform: translate(-50%, -50%) scale(0); opacity: 0; } 20% { transform: translate(-50%, -50%) scale(1.3); opacity: 1; } 50% { transform: translate(-50%, -50%) scale(1); } 100% { transform: translate(-50%, -50%) scale(1); opacity: 0; } }
        @keyframes anticipation-glow { 0%, 100% { box-shadow: 0 0 0 rgba(255, 215, 0, 0); } 50% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.8); } }
        @keyframes anticipation-pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes cracker-shoot { 0% { transform: translate(0, 0) rotate(0deg) scale(1); opacity: 1; } 70% { opacity: 1; } 100% { transform: translate(calc(var(--target-x) - 50vw), calc(var(--target-y) - 50vh)) rotate(var(--rotation)) scale(0.3); opacity: 0; } }

        /* ÂÆåÂÖ®‰æùÂ≠ò„É¨„Éô„É´„ÅÆÊºîÂá∫„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
        @keyframes near-miss-intense { 0% { opacity: 0; } 30% { opacity: 1; } 70% { opacity: 0.8; } 100% { opacity: 0; } }
        @keyframes whiff-darken { 0% { opacity: 0; } 50% { opacity: 1; } 100% { opacity: 0; } }
        @keyframes whiff-fade { 0% { transform: translate(0, 0); opacity: 1; } 100% { transform: translate(var(--vx), var(--vy)); opacity: 0; } }
        @keyframes normal-flash { 0% { opacity: 0; } 40% { opacity: 1; } 100% { opacity: 0; } }
        @keyframes ring-expand { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(15); opacity: 0; } }
        @keyframes reward-particle-glow { 0% { transform: translate(0, 0); opacity: 1; } 100% { transform: translate(var(--vx), var(--vy)); opacity: 0; } }
        @keyframes big-rainbow-flash { 0% { opacity: 0; } 30% { opacity: 1; } 70% { opacity: 0.8; } 100% { opacity: 0; } }
        @keyframes beam-pulse { 0%, 100% { opacity: 0.4; } 50% { opacity: 1; } }
        @keyframes explosion { 0% { transform: scale(0); opacity: 1; } 50% { transform: scale(1.5); opacity: 0.8; } 100% { transform: scale(3); opacity: 0; } }
        @keyframes reward-fall-glow { 0% { transform: translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(1080deg); opacity: 0; } }
        @keyframes big-text { 0% { transform: translate(-50%, -50%) scale(0) rotate(-20deg); opacity: 0; } 30% { transform: translate(-50%, -50%) scale(1.3) rotate(5deg); opacity: 1; } 50% { transform: translate(-50%, -50%) scale(1) rotate(0deg); } 100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 0; } }
        @keyframes jackpot-mega-flash { 0% { opacity: 0; } 20% { opacity: 1; } 50% { opacity: 0.9; } 80% { opacity: 1; } 100% { opacity: 0; } }
        @keyframes screen-shake-intense { 0%, 100% { transform: translate(0, 0); } 5%, 15%, 25%, 35%, 45%, 55%, 65%, 75%, 85%, 95% { transform: translate(-10px, 10px); } 10%, 20%, 30%, 40%, 50%, 60%, 70%, 80%, 90% { transform: translate(10px, -10px); } }
        @keyframes mega-wave-expand { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(30); opacity: 0; } }
        @keyframes spiral-rotate-cw { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes spiral-rotate-ccw { 0% { transform: rotate(0deg); } 100% { transform: rotate(-360deg); } }
        @keyframes starburst-pulse { 0% { opacity: 0; transform: scale(0); } 30% { opacity: 1; transform: scale(1); } 100% { opacity: 0; transform: scale(1.5); } }
        @keyframes reward-fall-mega-glow { 0% { transform: translateY(0) rotate(0deg) scale(1); opacity: 1; } 100% { transform: translateY(100vh) rotate(1440deg) scale(0.5); opacity: 0; } }
        @keyframes jackpot-mega-text { 0% { transform: translate(-50%, -50%) scale(0); opacity: 0; } 20% { transform: translate(-50%, -50%) scale(1.5); opacity: 1; } 40% { transform: translate(-50%, -50%) scale(0.9); } 50% { transform: translate(-50%, -50%) scale(1.1); } 60% { transform: translate(-50%, -50%) scale(1); } 100% { transform: translate(-50%, -50%) scale(1); opacity: 1; } }
        @keyframes jackpot-subtext { 0% { opacity: 0; transform: translateY(50px); } 50% { opacity: 1; transform: translateY(0); } 100% { opacity: 1; transform: translateY(0); } }

        /* ‰∏≠ÊØíÊÄßMAXÂÆùÁÆ±„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
        @keyframes chest-float { 0%, 100% { transform: translateY(0px) rotate(-2deg); } 50% { transform: translateY(-15px) rotate(2deg); } }
        @keyframes chest-shake-anticipation { 0%, 100% { transform: rotate(0deg); } 25% { transform: rotate(-5deg); } 75% { transform: rotate(5deg); } }
        @keyframes chest-lid-open { 0% { transform: rotateX(0deg); transform-origin: bottom; } 100% { transform: rotateX(-120deg); transform-origin: bottom; } }
        @keyframes chest-glow-pulse { 0%, 100% { box-shadow: 0 0 20px rgba(150, 180, 255, 0.5), 0 0 40px rgba(100, 150, 255, 0.3); } 50% { box-shadow: 0 0 40px rgba(150, 180, 255, 0.8), 0 0 80px rgba(100, 150, 255, 0.6), 0 0 120px rgba(80, 130, 255, 0.4); } }
        @keyframes sparkle-twinkle { 0%, 100% { opacity: 0; transform: scale(0) rotate(0deg); } 50% { opacity: 1; transform: scale(1) rotate(180deg); } }
        @keyframes light-ray-rotate { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes chest-burst-open { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.2); } 100% { transform: scale(1); opacity: 0; } }
        @keyframes reward-emerge { 0% { transform: translateY(50px) scale(0); opacity: 0; } 60% { transform: translateY(-20px) scale(1.2); opacity: 1; } 100% { transform: translateY(0) scale(1); opacity: 1; } }

        /* „ÇÆ„É£„É≥„Éñ„É´‰æùÂ≠òÊÄßÔºöÂÆùÁÆ±„ÅÆ‰∫àÂëäÔºÜ„Éã„Ç¢„Éü„ÇπÊºîÂá∫ */
        @keyframes chest-anticipation-shake { 0%, 100% { transform: translate(0, 0) rotate(0deg) scale(1); } 10% { transform: translate(-8px, -8px) rotate(-10deg) scale(1.05); } 20% { transform: translate(8px, 8px) rotate(10deg) scale(1.05); } 30% { transform: translate(-8px, 8px) rotate(-10deg) scale(1.05); } 40% { transform: translate(8px, -8px) rotate(10deg) scale(1.05); } 50% { transform: translate(-6px, -6px) rotate(-8deg) scale(1.03); } 60% { transform: translate(6px, 6px) rotate(8deg) scale(1.03); } 70% { transform: translate(-4px, 4px) rotate(-5deg) scale(1.02); } 80% { transform: translate(4px, -4px) rotate(5deg) scale(1.02); } 90% { transform: translate(-2px, 2px) rotate(-2deg) scale(1.01); } }
        @keyframes chest-color-tease { 0% { filter: hue-rotate(0deg) brightness(1) saturate(1); } 20% { filter: hue-rotate(60deg) brightness(1.3) saturate(1.8); } 40% { filter: hue-rotate(120deg) brightness(1.5) saturate(2); } 60% { filter: hue-rotate(180deg) brightness(1.7) saturate(2.2); } 80% { filter: hue-rotate(240deg) brightness(1.5) saturate(2); } 100% { filter: hue-rotate(300deg) brightness(1.3) saturate(1.8); } }
        @keyframes chest-glow-intensify { 0% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); } 25% { box-shadow: 0 0 60px rgba(255, 100, 255, 1), 0 0 100px rgba(255, 100, 255, 0.8); } 50% { box-shadow: 0 0 80px rgba(255, 50, 50, 1), 0 0 120px rgba(255, 50, 50, 0.9), 0 0 160px rgba(255, 50, 50, 0.7); } 75% { box-shadow: 0 0 60px rgba(100, 255, 255, 1), 0 0 100px rgba(100, 255, 255, 0.8); } 100% { box-shadow: 0 0 80px rgba(255, 215, 0, 1), 0 0 120px rgba(255, 215, 0, 0.9); } }
        @keyframes near-miss-flash { 0% { opacity: 0; transform: scale(1); } 30% { opacity: 1; transform: scale(1.2); } 60% { opacity: 0.8; transform: scale(1.1); } 100% { opacity: 0; transform: scale(1.3); } }
        @keyframes heartbeat-pulse { 0%, 100% { transform: scale(1); } 10% { transform: scale(1.1); } 20% { transform: scale(1); } 30% { transform: scale(1.15); } 40% { transform: scale(1); } }

        /* „Ç´„Ç∏„Éé„Ç∞„É¨„Éº„ÉâÊºîÂá∫ÔºöÁâ©ÁêÜ„Å™„Åó„ÉªÈ´òÁ¥ö„Ç∏„É•„Éº„Çπ */
        @keyframes spatial-distortion { 0% { transform: scale(1) skewX(0deg); } 25% { transform: scale(1.05) skewX(5deg); } 50% { transform: scale(0.95) skewX(-5deg); } 75% { transform: scale(1.02) skewX(2deg); } 100% { transform: scale(1) skewX(0deg); } }
        @keyframes chromatic-aberration { 0% { text-shadow: 0 0 0 rgba(255,0,0,0), 0 0 0 rgba(0,255,255,0); } 50% { text-shadow: -5px 0 0 rgba(255,0,0,0.8), 5px 0 0 rgba(0,255,255,0.8); } 100% { text-shadow: 0 0 0 rgba(255,0,0,0), 0 0 0 rgba(0,255,255,0); } }
        @keyframes light-convergence { 0% { transform: scale(3); opacity: 0; } 50% { transform: scale(0.5); opacity: 1; } 100% { transform: scale(0); opacity: 0; } }
        @keyframes whiteout-burst { 0% { opacity: 0; } 30% { opacity: 1; } 100% { opacity: 0; } }
        @keyframes screen-shake-brutal { 0%, 100% { transform: translate(0, 0); } 10% { transform: translate(-15px, 10px); } 20% { transform: translate(15px, -10px); } 30% { transform: translate(-10px, -15px); } 40% { transform: translate(10px, 15px); } 50% { transform: translate(-12px, 8px); } 60% { transform: translate(12px, -8px); } 70% { transform: translate(-8px, -12px); } 80% { transform: translate(8px, 12px); } 90% { transform: translate(-5px, 5px); } }
        @keyframes resistance-denial { 0% { transform: translateX(0) rotate(0deg); } 10% { transform: translateX(-20px) rotate(-15deg); } 20% { transform: translateX(15px) rotate(10deg); } 30% { transform: translateX(-10px) rotate(-8deg); } 40% { transform: translateX(5px) rotate(5deg); } 50% { transform: translateX(-3px) rotate(-3deg); } 100% { transform: translateX(0) rotate(0deg); } }
        @keyframes jackpot-peek { 0% { opacity: 0; transform: translateY(30px) scale(0.5); } 40% { opacity: 1; transform: translateY(0) scale(1); } 60% { opacity: 1; transform: translateY(0) scale(1); } 100% { opacity: 0; transform: translateY(-30px) scale(0.8); } }
        @keyframes charge-buildup { 0% { box-shadow: 0 0 0 rgba(100,150,255,0); transform: scale(1); } 100% { box-shadow: 0 0 50px rgba(100,150,255,1), 0 0 100px rgba(100,150,255,0.8), 0 0 150px rgba(100,150,255,0.6); transform: scale(1.15); } }
        @keyframes roulette-spin { 0% { transform: translateY(0); } 100% { transform: translateY(-500%); } }
        @keyframes roulette-slowdown { 0% { transform: translateY(0); } 100% { transform: translateY(-100%); } }
        @keyframes slot-stop-slam { 0% { transform: translateY(0) scale(1); } 20% { transform: translateY(-30px) scale(1.15); } 50% { transform: translateY(10px) scale(0.9); } 80% { transform: translateY(-5px) scale(1.05); } 100% { transform: translateY(0) scale(1); } }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background-color: #dadce0; border-radius: 4px; }

        .progress-glow { filter: drop-shadow(0 0 4px rgba(255, 255, 255, 0.8)) brightness(1.2); }
        .fire-active { animation: flame-grow 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        /* --- 3DÂÆùÁÆ±Áî® È´òÂ∫¶„Çπ„Çø„Ç§„É´ --- */
        .chest-scene { perspective: 1200px; transform-style: preserve-3d; }
        .chest-3d { transform-style: preserve-3d; width: 100%; height: 100%; position: relative; }
        .face { position: absolute; backface-visibility: visible; }
        
        /* È´òÁ¥ö„Éû„ÉÉ„Éà„Éñ„É©„ÉÉ„ÇØ„ÅÆË≥™ÊÑü */
        .mat-black-surface {
            background: linear-gradient(135deg, #222 0%, #1a1a1a 100%);
            box-shadow: inset 0 0 15px rgba(0,0,0,0.8);
        }
        /* „Éó„É©„ÉÅ„Éä„Ç∑„É´„Éê„Éº„ÅÆÈáëÂ±ûÂÖâÊ≤¢ÔºàÁ∏ÅÂèñ„ÇäÁî®Ôºâ */
        .platinum-rim {
            background: linear-gradient(90deg, #555 0%, #999 20%, #fff 50%, #999 80%, #555 100%);
            box-shadow: 0 0 5px rgba(255,255,255,0.3);
        }

        /* „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥: ÂëºÂê∏„Åô„Çã„Çà„ÅÜ„Å™ÂæÖÊ©üÁä∂ÊÖã */
        @keyframes chest-breathe {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-4px) scale(1.01); }
        }
        /* „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥: ÈöôÈñì„Åã„Çâ„ÅÆÂÖâÊºè„Çå */
        @keyframes leak-light {
            0%, 100% { opacity: 0.3; transform: scaleX(0.8); }
            50% { opacity: 0.8; transform: scaleX(1.1); filter: blur(4px); }
        }   
    </style>
</head>
<body class="bg-white h-screen overflow-hidden text-duo-text">
    <div id="root" class="h-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo, useCallback } = React;

        // --- Èü≥Èüø„Ç®„É≥„Ç∏„É≥ ---
        const AudioEngine = {
            ctx: null,
            init() { if (!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)(); },
            play(freqs, type = 'sine', volume = 0.1, interval = 0.08) {
                this.init();
                if (this.ctx.state === 'suspended') this.ctx.resume();
                const now = this.ctx.currentTime;
                freqs.forEach((f, i) => {
                    const osc = this.ctx.createOscillator();
                    const gain = this.ctx.createGain();
                    osc.type = type;
                    osc.frequency.setValueAtTime(f, now + i * interval);
                    gain.gain.setValueAtTime(0, now + i * interval);
                    gain.gain.linearRampToValueAtTime(volume, now + i * interval + 0.02);
                    gain.gain.exponentialRampToValueAtTime(0.01, now + i * interval + 0.25);
                    osc.connect(gain);
                    gain.connect(this.ctx.destination);
                    osc.start(now + i * interval);
                    osc.stop(now + i * interval + 0.3);
                });
            }
        };

        // --- Icons ---
        const SvgIcon = ({ children, size = 20, className = "", ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
        );
        const Icons = {
            Menu: (p) => <SvgIcon {...p}><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></SvgIcon>,
            Plus: (p) => <SvgIcon {...p}><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></SvgIcon>,
            Check: (p) => <SvgIcon {...p}><polyline points="20 6 9 17 4 12"/></SvgIcon>,
            Trash2: (p) => <SvgIcon {...p}><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></SvgIcon>,
            Calendar: (p) => <SvgIcon {...p}><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></SvgIcon>,
            Flame: (p) => <SvgIcon {...p}><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.1.2-2.2.6-3.3a1 1 0 0 1 .9 3.8z"/></SvgIcon>,
            Gem: (p) => <SvgIcon {...p}><path d="M6 3h12l4 6-10 12L2 9z"/><path d="M11 3v18"/><path d="M6 3l5 6 5-6"/><path d="M2 9h20"/></SvgIcon>,
            ShoppingBag: (p) => <SvgIcon {...p}><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></SvgIcon>,
            ChevronDown: (p) => <SvgIcon {...p}><polyline points="6 9 12 15 18 9"/></SvgIcon>,
            ChevronUp: (p) => <SvgIcon {...p}><polyline points="18 15 12 9 6 15"/></SvgIcon>,
            ChevronRight: (p) => <SvgIcon {...p}><polyline points="9 18 15 12 9 6"/></SvgIcon>,
            Edit: (p) => <SvgIcon {...p}><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></SvgIcon>,
            GripVertical: (p) => <SvgIcon {...p}><circle cx="9" cy="12" r="1"/><circle cx="9" cy="5" r="1"/><circle cx="9" cy="19" r="1"/><circle cx="15" cy="12" r="1"/><circle cx="15" cy="5" r="1"/><circle cx="15" cy="19" r="1"/></SvgIcon>,
            Star: (p) => <SvgIcon {...p} fill={p.active ? "currentColor" : "none"}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></SvgIcon>,
            Play: (p) => <SvgIcon {...p}><polygon points="5 3 19 12 5 21 5 3"/></SvgIcon>,
            Pause: (p) => <SvgIcon {...p}><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></SvgIcon>,
            AlertCircle: (p) => <SvgIcon {...p}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></SvgIcon>,
            Potion: (p) => <SvgIcon {...p}><path d="M8.5 2h7"/><path d="M12 2v4"/><path d="M16.5 10a4.5 4.5 0 0 0-9 0l-.5 8h10l-.5-8Z"/><line x1="12" y1="12" x2="12" y2="14"/><line x1="10" y1="15" x2="10.5" y2="15"/></SvgIcon>,
            Ticket: (p) => <SvgIcon {...p}><path d="M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/><path d="M13 5v2"/><path d="M13 17v2"/><path d="M13 11v2"/></SvgIcon>,
            Sparkles: (p) => <SvgIcon {...p}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 7h4"/><path d="M3 5h4"/></SvgIcon>,
            Cherry: (p) => <SvgIcon {...p}><path d="M2 8a5 5 0 0 0 10 0c0-2.76-2.5-5-5-5-2.5 0-5 2.24-5 5Z"/><path d="M12 8a5 5 0 0 0 10 0c0-2.76-2.5-5-5-5-2.5 0-5 2.24-5 5Z"/><path d="M7 3c2.5-1.5 5 0 10 2"/></SvgIcon>,
            Snowflake: (p) => <SvgIcon {...p}><line x1="12" y1="2" x2="12" y2="22"/><line x1="20" y1="12" x2="4" y2="12"/><line x1="17.66" y1="6.34" x2="6.34" y2="17.66"/><line x1="17.66" y1="17.66" x2="6.34" y2="6.34"/></SvgIcon>,
            Chest: (p) => <SvgIcon {...p}><rect x="3" y="8" width="18" height="4" rx="1"/><path d="M12 8v13"/><path d="M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7"/><path d="M7.5 8a2.5 2.5 0 0 1 0-5A2.5 2.5 0 0 1 12 5.5V8"/><path d="M16.5 8a2.5 2.5 0 0 1 0-5A2.5 2.5 0 0 1 12 5.5V8"/></SvgIcon>,
            Gift: (p) => <SvgIcon {...p}><rect x="3" y="8" width="18" height="4" rx="1" /><path d="M12 8v13" /><path d="M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7" /><path d="M7.5 8a2.5 2.5 0 0 1 0-5A2.5 2.5 0 0 1 12 5.5V8" /><path d="M16.5 8a2.5 2.5 0 0 1 0-5A2.5 2.5 0 0 1 12 5.5V8" /></SvgIcon>,
            Clock: (p) => <SvgIcon {...p}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></SvgIcon>,
            Rocket: (p) => <SvgIcon {...p}><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"/><path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"/><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"/><path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"/></SvgIcon>,
            Divide: (p) => <SvgIcon {...p}><circle cx="12" cy="6" r="2" /><line x1="5" y1="12" x2="19" y2="12" /><circle cx="12" cy="18" r="2" /></SvgIcon>,
            Merge: (p) => <SvgIcon {...p}><path d="m8 6 4-4 4 4"/><path d="M12 2v10.3"/><path d="M12 12.3v8.2"/><path d="m8 18 4 4 4-4"/></SvgIcon>,
            Terminal: (p) => <SvgIcon {...p}><polyline points="4 17 10 11 4 5" /><line x1="12" y1="19" x2="20" y2="19" /></SvgIcon>,
            Search: (p) => <SvgIcon {...p}><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></SvgIcon>,
            Shield: (p) => <SvgIcon {...p}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></SvgIcon>,
            Zap: (p) => <SvgIcon {...p}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></SvgIcon>,
            Trash: (p) => <SvgIcon {...p}><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></SvgIcon>,
        };

        // --- ÂÖ±ÈÄöUIÈÉ®ÂìÅ ---
        const juicyBtnClass = "transition-all duration-150 transform hover:scale-105 active:scale-95 active:translate-y-1";

        const IconButton = ({ icon: Icon, onClick, className = "", active = false, size = 20, color="text-google-textSec", ...props }) => (
            <button onClick={onClick} className={`p-2 rounded-full flex items-center justify-center hover:bg-google-hover ${active ? 'bg-google-selected text-google-blue' : color} ${className} ${juicyBtnClass}`} {...props}>
                <Icon size={size} active={active} />
            </button>
        );

        const Toast = ({ message, onClose }) => {
            useEffect(() => { const timer = setTimeout(onClose, 3000); return () => clearTimeout(timer); }, [onClose]);
            return (
                <div className="fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-red-500 text-white px-6 py-3 rounded-2xl shadow-floating z-[120] flex items-center gap-3 animate-toast-in font-black whitespace-nowrap border-b-4 border-red-700">
                    <Icons.AlertCircle size={24} /><span>{message}</span>
                </div>
            );
        };

        const FloatingText = ({ x, y, text, color, scale }) => (
            <div className={`fixed z-[150] pointer-events-none flex items-center gap-1 animate-float-up drop-shadow-md whitespace-nowrap ${color} ${scale}`} style={{ left: x, top: y }}>
                {text}
            </div>
        );

        const IgnitionModal = () => (
            <div className="fixed inset-0 pointer-events-none z-[200] flex items-center justify-center">
                <div className="absolute inset-0 bg-orange-500/20 animate-ignition"></div>
                <div className="text-9xl text-duo-orange animate-ignition flex items-center justify-center drop-shadow-2xl">
                    üî•
                </div>
                <div className="absolute top-1/3 text-4xl font-black text-white animate-ignition drop-shadow-lg uppercase tracking-widest">
                    STREAK IGNITED!
                </div>
            </div>
        );

        // --- Context Menu ---
        const ContextMenu = ({ x, y, onDivide, onMerge, onPurge, showMerge, showPurge }) => (
            <div className="fixed z-[9999] bg-white border-2 border-gray-200 rounded-xl shadow-floating py-1 w-56 animate-scale-in" style={{ left: x, top: y }}>
                <button onClick={onDivide} className="w-full text-left px-4 py-3 hover:bg-gray-50 flex items-center gap-2 font-bold text-gray-600 text-sm">
                    <Icons.Divide size={16} /> „Åì„Åì„ÅßÂå∫Âàá„Çã
                </button>
                {showMerge && (
                    <button onClick={onMerge} className="w-full text-left px-4 py-3 hover:bg-gray-50 flex items-center gap-2 font-bold text-gray-600 text-sm">
                        <Icons.Merge size={16} /> Âå∫Âàá„Çä„ÇíÂâäÈô§
                    </button>
                )}
                {showPurge && (
                    <div className="border-t border-gray-100 mt-1 pt-1">
                        <button onClick={onPurge} className="w-full text-left px-4 py-3 hover:bg-red-50 flex items-center gap-2 font-bold text-red-500 text-sm">
                            <Icons.Trash size={16} /> Post-MVP„Å∏„Éë„Éº„Ç∏
                        </button>
                    </div>
                )}
            </div>
        );

        // --- „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£ ---
        const getAdjustedToday = () => {
            const d = new Date(); d.setHours(d.getHours() - 3); return d.toISOString().split('T')[0];
        };

        // üé∞ LDWSÁêÜË´ñÔºöÂ†±ÈÖ¨„ÉÜ„Ç£„Ç¢Ê±∫ÂÆöÈñ¢Êï∞ÔºàÊêçÂ§±„ÇíÂãùÂà©„Å´ÂÅΩË£ÖÔºâ
        const determineRewardTier = (pityCounter, isFeverMode) => {
            // Âü∫Êú¨Á¢∫ÁéáÔºàLDWSÊßãÈÄ†Ôºâ
            let whiffChance = 45;      // ÂÆåÂÖ®„Éè„Ç∫„É¨ÔºàÊÇî„Åó„ÅïÔºâ
            let smallChance = 35;      // Â∞èÂΩì„Åü„ÇäÔºàÂª∂ÂëΩÊé™ÁΩÆ„ÉªLDWsÔºâ
            let normalChance = 14;     // Ê∫ÄË∂≥ÊÑüÔºàÁøíÊÖ£ÂåñÔºâ
            let bigChance = 5;         // Âº∑„ÅÑÂø´Ê•ΩÔºà‰∏≠ÊØí„ÅÆÁ∂≠ÊåÅÔºâ
            let jackpotChance = 1;     // Á•ûË©±ÁöÑÊàêÂäüÔºàÂ∞ÑÂπ∏ÂøÉ„ÅÆÊ†∏ÂøÉÔºâ

            // Â§©‰∫ï„Ç∑„Çπ„ÉÜ„É†Ôºö„Çπ„Ç´„ÅåÁ∂ö„Åè„Å®Á¢∫Áéá‰∏äÊòá
            const pityBonus = Math.min(pityCounter * 2, 30); // ÊúÄÂ§ß30%„Éñ„Éº„Çπ„Éà
            jackpotChance += pityBonus * 0.5;
            bigChance += pityBonus * 0.5;
            whiffChance -= pityBonus;

            // „Éï„Ç£„Éº„Éê„Éº„É¢„Éº„ÉâÔºö„É¨„Ç¢Á¢∫Áéá2ÂÄç
            if (isFeverMode) {
                const originalBig = bigChance;
                const originalJackpot = jackpotChance;
                bigChance = Math.min(originalBig * 2, 40);
                jackpotChance = Math.min(originalJackpot * 2, 30);
                const boost = (bigChance - originalBig) + (jackpotChance - originalJackpot);
                whiffChance -= boost;
                smallChance = Math.max(smallChance - boost * 0.3, 10);
            }

            // ÊäΩÈÅ∏
            const roll = Math.random() * 100;
            if (roll < jackpotChance) return 'jackpot';
            if (roll < jackpotChance + bigChance) return 'big';
            if (roll < jackpotChance + bigChance + normalChance) return 'normal';
            if (roll < jackpotChance + bigChance + normalChance + smallChance) return 'small';
            return 'whiff';
        };

        const Confetti = ({ type, theme }) => {
            const performanceColors = ['bg-yellow-400', 'bg-yellow-300', 'bg-gray-300', 'bg-gray-200'];
            const colors = performanceColors; 
            
            // Checkbox Ignition (Small Confetti)
            const isSmall = type === 'ignition';
            const particlesCount = isSmall ? 8 : (type === 'big' || type === 'performance' ? 45 : 12);
            
            const particles = Array.from({ length: particlesCount }).map((_, i) => ({
                id: i, 
                tx: (Math.random()-0.5)*(isSmall ? 60 : 240), 
                ty: (Math.random()-0.5)*(isSmall ? 60 : 240), 
                size: Math.random()*(isSmall ? 3 : 7)+2, 
                color: colors[Math.floor(Math.random()*colors.length)],
                rotation: Math.random() * 360
            }));

            return (
                <div className="absolute inset-0 flex items-center justify-center pointer-events-none z-50 overflow-visible">
                    {particles.map(p => (
                        <div key={p.id} className={`absolute rounded-full ${p.color}`} 
                            style={{ 
                                width: p.size, 
                                height: p.size, 
                                '--tx': `${p.tx}px`, '--ty': `${p.ty}px`,
                                animation: 'confetti-explode 0.4s ease-out forwards',
                            }} 
                        />
                    ))}
                </div>
            );
        };

        // --- ÂÆåÂÖ®‰æùÂ≠ò„É¨„Éô„É´Ôºö4ÊÆµÈöéÂ†±ÈÖ¨ÊºîÂá∫„Ç∑„Çπ„ÉÜ„É† ---

        // „Éã„Ç¢„Éü„ÇπÊºîÂá∫ÔºöÈáëËâ≤„ÅÆ„Éï„É©„ÉÉ„Ç∑„É•
        const NearMissFlash = () => {
            return (
                <div
                    className="fixed inset-0 pointer-events-none z-[300]"
                    style={{
                        background: 'radial-gradient(circle, rgba(255,215,0,0.6) 0%, rgba(255,165,0,0.3) 40%, transparent 70%)',
                        animation: 'near-miss-intense 0.4s ease-out forwards',
                    }}
                />
            );
        };

        // „Çπ„Ç´ÊºîÂá∫Ôºà60%Ôºâ: ÊÇî„Åó„Åï„ÇíÂ¢óÂπÖ
        const RewardWhiff = ({ onComplete, showNearMiss }) => {
            const [particles, setParticles] = useState([]);

            useEffect(() => {
                // ÊÇî„Åó„ÅÑÊºîÂá∫ÔºöÊöó„ÅÑ„Éë„Éº„ÉÜ„Ç£„ÇØ„É´„ÅåÊ∂à„Åà„Çã
                const newParticles = [];
                for (let i = 0; i < 15; i++) {
                    const angle = (Math.PI * 2 * i) / 15;
                    newParticles.push({
                        id: i,
                        x: window.innerWidth / 2,
                        y: window.innerHeight / 2,
                        vx: Math.cos(angle) * 80,
                        vy: Math.sin(angle) * 80,
                        color: '#888888',
                        size: 6,
                    });
                }
                setParticles(newParticles);

                // üé∞ ÊÆãÂøµSE: „Çà„ÇäÈï∑„Åè„ÄÅ„Çà„ÇäËêΩËÉÜÊÑü„ÅÆ„ÅÇ„ÇãÈü≥
                if (showNearMiss) {
                    // „Éã„Ç¢„Éü„Çπ: ‰∏ÄÁû¨„ÄåÂΩì„Åü„ÇäÔºÅÔºü„Äç„Å®ÊÄù„Çè„Åõ„Å¶„Åã„ÇâËêΩ„Å®„Åô
                    AudioEngine.play([800, 1000], 'sine', 0.15, 0.1);
                    setTimeout(() => AudioEngine.play([500, 400, 300, 200, 150, 100], 'sawtooth', 0.15, 0.2), 100);
                } else {
                    // ÈÄöÂ∏∏„Çπ„Ç´: „Ç¨„ÉÉ„Ç´„É™Èü≥
                    AudioEngine.play([500, 400, 300, 200, 150, 100], 'sawtooth', 0.12, 0.18);
                }

                setTimeout(() => {
                    setParticles([]);
                    onComplete();
                }, 600);
            }, [onComplete]);

            return (
                <>
                    {showNearMiss && <NearMissFlash />}
                    {/* ÊöóËª¢„Ç®„Éï„Çß„ÇØ„Éà */}
                    <div
                        className="fixed inset-0 pointer-events-none z-[290]"
                        style={{
                            background: 'rgba(0, 0, 0, 0.3)',
                            animation: 'whiff-darken 0.6s ease-out forwards',
                        }}
                    />
                    {/* ÊÇî„Åó„ÅÑ„Éë„Éº„ÉÜ„Ç£„ÇØ„É´ */}
                    {particles.map(p => (
                        <div
                            key={p.id}
                            style={{
                                position: 'fixed',
                                left: p.x,
                                top: p.y,
                                width: `${p.size}px`,
                                height: `${p.size}px`,
                                backgroundColor: p.color,
                                borderRadius: '50%',
                                pointerEvents: 'none',
                                zIndex: 295,
                                animation: 'whiff-fade 0.6s ease-out forwards',
                                '--vx': `${p.vx}px`,
                                '--vy': `${p.vy}px`,
                            }}
                        />
                    ))}
                </>
            );
        };

        // üé∞ Â∞èÂΩì„Åü„ÇäÊºîÂá∫Ôºà40%Ôºâ: LDWs - Âú∞Âë≥„Å†„Åå„ÄåÂΩì„Åü„Å£„Åü„Äç„Å®„ÅÑ„ÅÜÊÑüËß¶
        const RewardSmallWin = ({ onComplete, centerX, centerY }) => {
            const [particles, setParticles] = useState([]);

            useEffect(() => {
                // Êéß„Åà„ÇÅ„Å™ÈáëËâ≤„Éë„Éº„ÉÜ„Ç£„ÇØ„É´Ôºà30ÂÄãÔºâ
                const goldShades = ['#FFD700', '#FFC700', '#FFB700'];
                const newParticles = [];
                for (let i = 0; i < 30; i++) {
                    const fromLeft = i % 2 === 0;
                    const startX = fromLeft ? '5%' : '95%';
                    const startY = '5%';

                    // Áã≠„ÅÑÁØÑÂõ≤„Å´ÈõÜ‰∏≠Ôºà‰∏≠Â§Æ¬±200pxÔºâ
                    const spreadX = (Math.random() - 0.5) * 200;
                    const spreadY = (Math.random() - 0.5) * 200;
                    const targetX = `${centerX + spreadX}px`;
                    const targetY = `${centerY + spreadY}px`;

                    newParticles.push({
                        id: i,
                        startX,
                        startY,
                        targetX,
                        targetY,
                        color: goldShades[i % goldShades.length],
                        delay: Math.random() * 0.2,
                        duration: 0.7 + Math.random() * 0.3,
                        size: 6 + Math.random() * 4,
                    });
                }
                setParticles(newParticles);

                // üé∞ Â∞èÂΩì„Åü„ÇäSE: Êéß„Åà„ÇÅ„Å™„ÉÅ„É™„É≥Èü≥Ôºà1Âõû„Å†„ÅëÔºâ
                AudioEngine.play([1047], 'sine', 0.15, 0.08);
                setTimeout(() => AudioEngine.play([1319], 'triangle', 0.12, 0.06), 100);

                setTimeout(() => {
                    setParticles([]);
                    onComplete();
                }, 1200);
            }, [centerX, centerY, onComplete]);

            return (
                <>
                    {/* Êéß„Åà„ÇÅ„Å™ÂÖâ„Éï„É©„ÉÉ„Ç∑„É• */}
                    <div
                        className="fixed inset-0 pointer-events-none z-[280]"
                        style={{
                            background: 'radial-gradient(circle, rgba(255,215,0,0.15) 0%, transparent 50%)',
                            animation: 'normal-flash 0.5s ease-out forwards',
                        }}
                    />
                    {/* Â∞èÂΩì„Åü„Çä„ÇØ„É©„ÉÉ„Ç´„Éº„Éë„Éº„ÉÜ„Ç£„ÇØ„É´ */}
                    {particles.map(p => (
                        <CrackerConfettiParticle key={p.id} {...p} />
                    ))}
                </>
            );
        };

        // „Éé„Éº„Éû„É´ÊºîÂá∫Ôºà22%Ôºâ: ËôπËâ≤„ÇØ„É©„ÉÉ„Ç´„Éº
        const RewardNormal = ({ onComplete, centerX, centerY }) => {
            const [particles, setParticles] = useState([]);
            const [rings, setRings] = useState([]);

            useEffect(() => {
                // ËôπËâ≤„ÅÆ„ÇØ„É©„ÉÉ„Ç´„Éº„Éë„Éº„ÉÜ„Ç£„ÇØ„É´Ôºà100ÂÄãÔºâ
                const rainbowColors = ['#FF6B9D', '#C44569', '#F8B500', '#4ECDC4', '#95E1D3', '#38B6FF', '#A8E6CF'];
                const newParticles = [];
                for (let i = 0; i < 100; i++) {
                    const fromLeft = i % 2 === 0;

                    // Â∑¶‰∏ã„Åæ„Åü„ÅØÂè≥‰∏ã„Åã„Çâ„ÅÆÁô∫Â∞Ñ
                    const startX = fromLeft ? '5%' : '95%';
                    const startY = '5%';

                    // ‰∏≠Â§Æ‰ªòËøë„Å∏„ÅÆ„É©„É≥„ÉÄ„É†„Å™ÁùÄÂú∞ÁÇπ
                    const spreadX = (Math.random() - 0.5) * 500;
                    const spreadY = (Math.random() - 0.5) * 500;
                    const targetX = `${centerX + spreadX}px`;
                    const targetY = `${centerY + spreadY}px`;

                    newParticles.push({
                        id: i,
                        startX,
                        startY,
                        targetX,
                        targetY,
                        color: rainbowColors[i % rainbowColors.length],
                        delay: Math.random() * 0.3,
                        duration: 0.9 + Math.random() * 0.4,
                        size: 10 + Math.random() * 8,
                    });
                }
                setParticles(newParticles);

                // Êã°Êï£„É™„É≥„Ç∞3„Å§
                setRings([{ id: 1 }, { id: 2 }, { id: 3 }]);

                // üé∞ ÂΩì„Åü„ÇäSE: „Éô„É´Èü≥ ‚Üí „Ç≥„Ç§„É≥Èü≥ÈÄ£Á∂ö
                // „Éô„É´Èü≥Ôºà„ÉÅ„Éº„É≥ÔºÅÔºâ
                AudioEngine.play([2093, 2093], 'sine', 0.25, 0.12);
                // „Ç≥„Ç§„É≥„Åå„ÉÅ„É£„É™„É≥„ÉÅ„É£„É™„É≥ËêΩ„Å°„ÇãÈü≥
                setTimeout(() => AudioEngine.play([880, 1047], 'triangle', 0.18, 0.06), 150);
                setTimeout(() => AudioEngine.play([932, 1109], 'triangle', 0.16, 0.05), 250);
                setTimeout(() => AudioEngine.play([987, 1175], 'triangle', 0.14, 0.05), 340);
                setTimeout(() => AudioEngine.play([1047, 1245], 'triangle', 0.12, 0.04), 420);
                setTimeout(() => AudioEngine.play([1109, 1319], 'triangle', 0.1, 0.04), 490);

                setTimeout(() => {
                    setParticles([]);
                    setRings([]);
                    onComplete();
                }, 2000);
            }, [centerX, centerY, onComplete]);

            return (
                <>
                    {/* ËôπËâ≤„Éï„É©„ÉÉ„Ç∑„É• */}
                    <div
                        className="fixed inset-0 pointer-events-none z-[280]"
                        style={{
                            background: 'radial-gradient(circle, rgba(255,107,157,0.4) 0%, rgba(62,207,196,0.3) 50%, transparent 70%)',
                            animation: 'normal-flash 0.8s ease-out forwards',
                        }}
                    />
                    {/* Êã°Êï£„É™„É≥„Ç∞ */}
                    {rings.map((r, i) => (
                        <div
                            key={r.id}
                            style={{
                                position: 'fixed',
                                left: centerX,
                                top: centerY,
                                width: '50px',
                                height: '50px',
                                marginLeft: '-25px',
                                marginTop: '-25px',
                                border: '4px solid rgba(255, 107, 157, 0.8)',
                                borderRadius: '50%',
                                pointerEvents: 'none',
                                zIndex: 285,
                                animation: `ring-expand 1s ease-out ${i * 0.15}s forwards`,
                            }}
                        />
                    ))}
                    {/* ËôπËâ≤„ÇØ„É©„ÉÉ„Ç´„Éº„Éë„Éº„ÉÜ„Ç£„ÇØ„É´ */}
                    {particles.map(p => (
                        <CrackerConfettiParticle key={p.id} {...p} />
                    ))}
                </>
            );
        };

        // „Éì„ÉÉ„Ç∞ÊºîÂá∫Ôºà10%Ôºâ: ÂúßÂÄíÁöÑ„É¨„Ç§„É≥„Éú„ÉºÁàÜÁô∫
        const RewardBig = ({ onComplete }) => {
            const [particles, setParticles] = useState([]);
            const [explosions, setExplosions] = useState([]);
            const [lightBeams, setLightBeams] = useState([]);

            useEffect(() => {
                // ÈÄ£Á∂öÁàÜÁô∫„Ç®„Éï„Çß„ÇØ„Éà
                setExplosions([
                    { id: 1, delay: 0, x: '30%', y: '30%' },
                    { id: 2, delay: 0.15, x: '70%', y: '40%' },
                    { id: 3, delay: 0.3, x: '50%', y: '60%' },
                    { id: 4, delay: 0.45, x: '20%', y: '70%' },
                    { id: 5, delay: 0.6, x: '80%', y: '20%' },
                ]);

                // ÂÖâÁ∑ö„Ç®„Éï„Çß„ÇØ„Éà
                setLightBeams([
                    { id: 1, angle: 0 },
                    { id: 2, angle: 60 },
                    { id: 3, angle: 120 },
                    { id: 4, angle: 180 },
                    { id: 5, angle: 240 },
                    { id: 6, angle: 300 },
                ]);

                // „É¨„Ç§„É≥„Éú„Éº„ÇØ„É©„ÉÉ„Ç´„ÉºÂ§ßÈáèÔºà300ÂÄãÔºâ
                const rainbowColors = ['#FF0080', '#FF8C00', '#FFD700', '#00FF00', '#00CED1', '#4169E1', '#9370DB'];
                const centerX = window.innerWidth / 2;
                const centerY = window.innerHeight / 2;
                const newParticles = [];
                for (let i = 0; i < 300; i++) {
                    const fromLeft = i % 2 === 0;
                    const startX = fromLeft ? '5%' : '95%';
                    const startY = '5%';

                    // ‰∏≠Â§Æ‰ªòËøë„Å∏„ÅÆÁùÄÂú∞ÁÇπÔºàÂ∫ÉÁØÑÂõ≤Ôºâ
                    const spreadX = (Math.random() - 0.5) * 700;
                    const spreadY = (Math.random() - 0.5) * 700;
                    const targetX = `${centerX + spreadX}px`;
                    const targetY = `${centerY + spreadY}px`;

                    newParticles.push({
                        id: i,
                        startX,
                        startY,
                        targetX,
                        targetY,
                        color: rainbowColors[i % rainbowColors.length],
                        delay: Math.random() * 0.5,
                        duration: 1 + Math.random() * 0.6,
                        size: 14 + Math.random() * 10,
                    });
                }
                setParticles(newParticles);

                // üé∞ BIGÂΩì„Åü„ÇäSE: „Éâ„É©„É†„É≠„Éº„É´ ‚Üí „Éï„Ç°„É≥„Éï„Ç°„Éº„É¨ ‚Üí „Éô„É´ÈÄ£Êâì
                // „Éâ„É©„É†„É≠„Éº„É´È¢®ÔºàÈÄ£Á∂öÈü≥Ôºâ
                AudioEngine.play([200, 210, 220, 230], 'sawtooth', 0.2, 0.05);
                setTimeout(() => AudioEngine.play([210, 220, 230, 240], 'sawtooth', 0.22, 0.05), 60);
                setTimeout(() => AudioEngine.play([220, 230, 240, 250], 'sawtooth', 0.24, 0.05), 120);
                setTimeout(() => AudioEngine.play([230, 240, 250, 260], 'sawtooth', 0.26, 0.05), 180);

                // „Éï„Ç°„É≥„Éï„Ç°„Éº„É¨ÔºàË±™ËèØ„Å™‰∏äÊòáÈü≥ÈöéÔºâ
                setTimeout(() => AudioEngine.play([523, 659, 784, 1047, 1319, 1568], 'triangle', 0.32, 0.2), 300);
                setTimeout(() => AudioEngine.play([659, 784, 1047, 1319, 1568, 2093], 'sine', 0.3, 0.18), 500);

                // „Éô„É´ÈÄ£ÊâìÔºà„ÉÅ„Éº„É≥„ÉÅ„Éº„É≥„ÉÅ„Éº„É≥ÔºÅÔºâ
                setTimeout(() => AudioEngine.play([2093], 'sine', 0.28, 0.08), 800);
                setTimeout(() => AudioEngine.play([2349], 'sine', 0.3, 0.08), 950);
                setTimeout(() => AudioEngine.play([2637], 'sine', 0.32, 0.08), 1100);
                setTimeout(() => AudioEngine.play([2093, 2349, 2637], 'sine', 0.35, 0.12), 1250);

                setTimeout(() => {
                    setParticles([]);
                    setExplosions([]);
                    setLightBeams([]);
                    onComplete();
                }, 4000);
            }, [onComplete]);

            return (
                <>
                    {/* „É¨„Ç§„É≥„Éú„Éº„Éï„É©„ÉÉ„Ç∑„É• */}
                    <div
                        className="fixed inset-0 pointer-events-none z-[280]"
                        style={{
                            background: 'radial-gradient(circle, rgba(255,0,128,0.5) 0%, rgba(255,215,0,0.4) 30%, rgba(0,206,209,0.3) 60%, transparent 100%)',
                            animation: 'big-rainbow-flash 1.5s ease-out forwards',
                        }}
                    />
                    {/* ÂÖâÁ∑ö */}
                    {lightBeams.map(b => (
                        <div
                            key={b.id}
                            style={{
                                position: 'fixed',
                                left: '50%',
                                top: '50%',
                                width: '1000px',
                                height: '8px',
                                marginLeft: '-500px',
                                marginTop: '-4px',
                                background: 'linear-gradient(90deg, transparent 0%, rgba(255,215,0,0.8) 50%, transparent 100%)',
                                transform: `rotate(${b.angle}deg)`,
                                transformOrigin: 'center',
                                pointerEvents: 'none',
                                zIndex: 285,
                                animation: 'beam-pulse 2s ease-in-out infinite',
                            }}
                        />
                    ))}
                    {/* ÈÄ£Á∂öÁàÜÁô∫ */}
                    {explosions.map(exp => (
                        <div
                            key={exp.id}
                            style={{
                                position: 'fixed',
                                left: exp.x,
                                top: exp.y,
                                width: '100px',
                                height: '100px',
                                marginLeft: '-50px',
                                marginTop: '-50px',
                                borderRadius: '50%',
                                background: 'radial-gradient(circle, rgba(255,215,0,0.9) 0%, rgba(255,0,128,0.6) 50%, transparent 100%)',
                                pointerEvents: 'none',
                                zIndex: 288,
                                animation: `explosion ${0.8}s ease-out ${exp.delay}s forwards`,
                            }}
                        />
                    ))}
                    {/* „É¨„Ç§„É≥„Éú„Éº„ÇØ„É©„ÉÉ„Ç´„Éº„Éë„Éº„ÉÜ„Ç£„ÇØ„É´ */}
                    {particles.map(p => (
                        <CrackerConfettiParticle key={p.id} {...p} />
                    ))}
                    {/* BIG!! „ÉÜ„Ç≠„Çπ„Éà */}
                    <div
                        className="fixed top-1/4 left-1/2 transform -translate-x-1/2 -translate-y-1/2 pointer-events-none z-[295]"
                        style={{ animation: 'big-text 2.5s ease-out forwards' }}
                    >
                        <div className="text-9xl font-black" style={{
                            background: 'linear-gradient(45deg, #FF0080, #FF8C00, #FFD700, #00FF00, #00CED1, #4169E1)',
                            WebkitBackgroundClip: 'text',
                            WebkitTextFillColor: 'transparent',
                            textShadow: '0 0 40px rgba(255,215,0,0.8)',
                        }}>
                            BIG!!!
                        </div>
                    </div>
                </>
            );
        };

        // „Ç∏„É£„ÉÉ„ÇØ„Éù„ÉÉ„ÉàÊºîÂá∫Ôºà5%Ôºâ: Á©∂Ê•µ„ÅÆÈªÑÈáëÁàÜÁô∫ - ÂÆåÂÖ®‰æùÂ≠ò„É¨„Éô„É´
        const RewardJackpot = ({ onComplete }) => {
            const [particles, setParticles] = useState([]);
            const [starBursts, setStarBursts] = useState([]);
            const [spirals, setSpirals] = useState([]);
            const [waves, setWaves] = useState([]);

            useEffect(() => {
                // ÁîªÈù¢ÊåØÂãïÔºàÂº∑ÁÉàÔºâ
                if (navigator.vibrate) {
                    navigator.vibrate([150, 50, 150, 50, 200, 50, 300]);
                }

                // ÊòüÂûã„Éê„Éº„Çπ„Éà
                const newStarBursts = [];
                for (let i = 0; i < 12; i++) {
                    const angle = (Math.PI * 2 * i) / 12;
                    newStarBursts.push({
                        id: i,
                        angle,
                        delay: i * 0.05,
                    });
                }
                setStarBursts(newStarBursts);

                // Ëû∫Êóã„Ç®„Éï„Çß„ÇØ„Éà
                setSpirals([
                    { id: 1, direction: 1, delay: 0 },
                    { id: 2, direction: -1, delay: 0.2 },
                    { id: 3, direction: 1, delay: 0.4 },
                ]);

                // Ê≥¢Âãï„Ç®„Éï„Çß„ÇØ„Éà
                setWaves([
                    { id: 1, delay: 0 },
                    { id: 2, delay: 0.3 },
                    { id: 3, delay: 0.6 },
                    { id: 4, delay: 0.9 },
                ]);

                // ÈáëËâ≤„ÇØ„É©„ÉÉ„Ç´„ÉºË∂ÖÂ§ßÈáèÔºà500ÂÄãÔºâ
                const goldShades = ['#FFD700', '#FFA500', '#FFDB58', '#FFE55C', '#FFF8DC'];
                const centerX = window.innerWidth / 2;
                const centerY = window.innerHeight / 2;
                const newParticles = [];
                for (let i = 0; i < 500; i++) {
                    const fromLeft = i % 2 === 0;
                    const startX = fromLeft ? '5%' : '95%';
                    const startY = '5%';

                    // ‰∏≠Â§Æ‰ªòËøë„Å∏„ÅÆÁùÄÂú∞ÁÇπÔºàË∂ÖÂ∫ÉÁØÑÂõ≤Ôºâ
                    const spreadX = (Math.random() - 0.5) * 900;
                    const spreadY = (Math.random() - 0.5) * 900;
                    const targetX = `${centerX + spreadX}px`;
                    const targetY = `${centerY + spreadY}px`;

                    newParticles.push({
                        id: i,
                        startX,
                        startY,
                        targetX,
                        targetY,
                        color: goldShades[i % goldShades.length],
                        delay: Math.random() * 0.6,
                        duration: 1.2 + Math.random() * 0.8,
                        size: 12 + Math.random() * 16,
                    });
                }
                setParticles(newParticles);

                // üé∞ JACKPOTÁ©∂Ê•µSE: „Çµ„Ç§„É¨„É≥ ‚Üí ÁàÜÁô∫ ‚Üí „Éï„Ç°„É≥„Éï„Ç°„Éº„É¨ ‚Üí „Éô„É´ÁãÇ‰π± ‚Üí 5ÁßíÈñìÈ≥¥„ÇäÁ∂ö„Åë„Çã
                // „Çµ„Ç§„É¨„É≥Èü≥Ôºà‰∏äÊòá‰∏ãÈôç„ÇíÁπ∞„ÇäËøî„ÅôÔºâ
                AudioEngine.play([400, 800], 'sawtooth', 0.3, 0.15);
                setTimeout(() => AudioEngine.play([800, 400], 'sawtooth', 0.3, 0.15), 150);
                setTimeout(() => AudioEngine.play([400, 900], 'sawtooth', 0.32, 0.15), 300);
                setTimeout(() => AudioEngine.play([900, 400], 'sawtooth', 0.32, 0.15), 450);

                // ÁàÜÁô∫Èü≥Ôºà„Éâ„Ç´„Éº„É≥ÔºÅÔºâ
                setTimeout(() => AudioEngine.play([100, 80, 60, 40], 'sawtooth', 0.4, 0.2), 600);

                // Á©∂Ê•µ„Éï„Ç°„É≥„Éï„Ç°„Éº„É¨Ôºà3ÈÄ£Á∂ö‰∏äÊòáÈü≥ÈöéÔºâ
                setTimeout(() => AudioEngine.play([659, 784, 1047, 1319, 1568, 2093], 'sine', 0.38, 0.22), 850);
                setTimeout(() => AudioEngine.play([784, 1047, 1319, 1568, 2093, 2637], 'triangle', 0.36, 0.2), 1050);
                setTimeout(() => AudioEngine.play([1047, 1319, 1568, 2093, 2637, 3136], 'sine', 0.34, 0.18), 1250);

                // „Éô„É´ÁãÇ‰π±ÈÄ£ÊâìÔºà10Âõû‰ª•‰∏ä„ÅÆ„Éô„É´Èü≥Ôºâ
                setTimeout(() => AudioEngine.play([2093], 'sine', 0.35, 0.08), 1500);
                setTimeout(() => AudioEngine.play([2349], 'sine', 0.36, 0.08), 1620);
                setTimeout(() => AudioEngine.play([2637], 'sine', 0.37, 0.08), 1740);
                setTimeout(() => AudioEngine.play([2093, 2349], 'sine', 0.38, 0.09), 1860);
                setTimeout(() => AudioEngine.play([2349, 2637], 'sine', 0.38, 0.09), 1980);
                setTimeout(() => AudioEngine.play([2637, 3136], 'sine', 0.38, 0.09), 2100);
                setTimeout(() => AudioEngine.play([2093, 2349, 2637], 'sine', 0.39, 0.1), 2220);
                setTimeout(() => AudioEngine.play([2349, 2637, 3136], 'sine', 0.39, 0.1), 2340);
                setTimeout(() => AudioEngine.play([2093, 2637], 'sine', 0.4, 0.1), 2460);
                setTimeout(() => AudioEngine.play([2349, 3136], 'sine', 0.4, 0.1), 2580);
                setTimeout(() => AudioEngine.play([2093, 2349, 2637, 3136], 'sine', 0.42, 0.15), 2700);

                // ÊúÄÂæå„ÅÆÂ§ßÁàÜÁô∫Èü≥ÔºàË∂ÖÂº∑Ë™øÔºâ
                setTimeout(() => AudioEngine.play([3136, 2637, 2093, 1568, 1319, 1047], 'sine', 0.45, 0.3), 2900);

                setTimeout(() => {
                    setParticles([]);
                    setStarBursts([]);
                    setSpirals([]);
                    setWaves([]);
                    onComplete();
                }, 5000);
            }, [onComplete]);

            return (
                <>
                    {/* ÈªÑÈáë„Éï„É©„ÉÉ„Ç∑„É•ÔºàÂº∑ÁÉàÔºâ */}
                    <div
                        className="fixed inset-0 pointer-events-none z-[280]"
                        style={{
                            background: 'radial-gradient(circle, rgba(255,215,0,0.9) 0%, rgba(255,165,0,0.7) 30%, rgba(255,215,0,0.5) 60%, transparent 100%)',
                            animation: 'jackpot-mega-flash 2s ease-out forwards',
                        }}
                    />
                    {/* ÁîªÈù¢ÊåØÂãï„Ç®„Éï„Çß„ÇØ„ÉàÔºàÂº∑ÂåñÔºâ */}
                    <div
                        className="fixed inset-0 pointer-events-none z-[282]"
                        style={{ animation: 'screen-shake-intense 1s ease-out forwards' }}
                    />
                    {/* Ê≥¢Âãï„É™„É≥„Ç∞ */}
                    {waves.map(w => (
                        <div
                            key={w.id}
                            style={{
                                position: 'fixed',
                                left: '50%',
                                top: '50%',
                                width: '50px',
                                height: '50px',
                                marginLeft: '-25px',
                                marginTop: '-25px',
                                border: '6px solid rgba(255, 215, 0, 0.9)',
                                borderRadius: '50%',
                                pointerEvents: 'none',
                                zIndex: 285,
                                animation: `mega-wave-expand 2s ease-out ${w.delay}s forwards`,
                            }}
                        />
                    ))}
                    {/* Ëû∫Êóã */}
                    {spirals.map(sp => (
                        <div
                            key={sp.id}
                            style={{
                                position: 'fixed',
                                left: '50%',
                                top: '50%',
                                width: '2000px',
                                height: '2000px',
                                marginLeft: '-1000px',
                                marginTop: '-1000px',
                                background: 'conic-gradient(from 0deg, transparent 0%, rgba(255,215,0,0.3) 10%, transparent 20%, rgba(255,215,0,0.3) 30%, transparent 40%)',
                                borderRadius: '50%',
                                pointerEvents: 'none',
                                zIndex: 283,
                                animation: `spiral-rotate-${sp.direction > 0 ? 'cw' : 'ccw'} 3s linear ${sp.delay}s infinite`,
                            }}
                        />
                    ))}
                    {/* ÊòüÂûã„Éê„Éº„Çπ„Éà */}
                    {starBursts.map(sb => (
                        <div
                            key={sb.id}
                            style={{
                                position: 'fixed',
                                left: '50%',
                                top: '50%',
                                width: '2000px',
                                height: '20px',
                                marginLeft: '-1000px',
                                marginTop: '-10px',
                                background: 'linear-gradient(90deg, transparent 0%, rgba(255,215,0,0.9) 50%, transparent 100%)',
                                transform: `rotate(${sb.angle}rad)`,
                                transformOrigin: 'center',
                                pointerEvents: 'none',
                                zIndex: 288,
                                animation: `starburst-pulse 2s ease-out ${sb.delay}s forwards`,
                            }}
                        />
                    ))}
                    {/* ÈªÑÈáë„ÇØ„É©„ÉÉ„Ç´„Éº„Éë„Éº„ÉÜ„Ç£„ÇØ„É´Ë∂ÖÂ§ßÈáè */}
                    {particles.map(p => (
                        <CrackerConfettiParticle key={p.id} {...p} />
                    ))}
                    {/* JACKPOT!!! „ÉÜ„Ç≠„Çπ„ÉàÔºàÂ∑®Â§ßÔºÜËÑàÂãïÔºâ */}
                    <div
                        className="fixed top-1/3 left-1/2 transform -translate-x-1/2 -translate-y-1/2 pointer-events-none z-[295]"
                        style={{ animation: 'jackpot-mega-text 3s ease-out forwards' }}
                    >
                        <div className="text-[12rem] font-black" style={{
                            background: 'linear-gradient(45deg, #FFD700, #FFA500, #FFD700, #FFF8DC, #FFD700)',
                            WebkitBackgroundClip: 'text',
                            WebkitTextFillColor: 'transparent',
                            textShadow: '0 0 60px rgba(255,215,0,1), 0 0 120px rgba(255,215,0,0.8), 0 0 180px rgba(255,165,0,0.6)',
                            filter: 'drop-shadow(0 0 40px rgba(255,215,0,1))',
                        }}>
                            JACKPOT!!!
                        </div>
                    </div>
                    {/* „Çµ„Éñ„ÉÜ„Ç≠„Çπ„Éà */}
                    <div
                        className="fixed top-1/2 left-1/2 transform -translate-x-1/2 translate-y-12 pointer-events-none z-[295]"
                        style={{ animation: 'jackpot-subtext 3s ease-out 0.5s forwards', opacity: 0 }}
                    >
                        <div className="text-4xl font-black text-yellow-300" style={{ textShadow: '0 0 20px rgba(255,215,0,1)' }}>
                            üî• FEVER MODE ACTIVATED üî•
                        </div>
                    </div>
                </>
            );
        };

        // --- „ÇØ„É©„ÉÉ„Ç´„ÉºÈ¢®Ëä±ÂêπÈõ™„Éë„Éº„ÉÜ„Ç£„ÇØ„É´„Ç∑„Çπ„ÉÜ„É†ÔºàÂÆùÁÆ±Áî®Ôºâ---
        const CrackerConfettiParticle = ({ startX, startY, targetX, targetY, color, delay, duration, size }) => {
            const randomRotation = Math.random() * 1080 - 540;

            return (
                <div
                    style={{
                        position: 'fixed',
                        left: startX,
                        bottom: startY,
                        width: `${size}px`,
                        height: `${size}px`,
                        backgroundColor: color,
                        opacity: 0.95,
                        borderRadius: '50%',
                        pointerEvents: 'none',
                        zIndex: 250,
                        animation: `cracker-shoot ${duration}s cubic-bezier(0.25, 0.46, 0.45, 0.94) ${delay}s forwards`,
                        transform: 'scale(1)',
                        boxShadow: color === '#FFD700' ? '0 0 15px rgba(255, 215, 0, 1)' : '0 0 15px rgba(192, 192, 192, 1)',
                        '--target-x': targetX,
                        '--target-y': targetY,
                        '--rotation': `${randomRotation}deg`,
                    }}
                />
            );
        };

        const ConfettiSystem = ({ rarity }) => {
            const [particles, setParticles] = useState([]);

            useEffect(() => {
                // „É¨„Ç¢„É™„ÉÜ„Ç£„Å´Âøú„Åò„Å¶„Éë„Éº„ÉÜ„Ç£„ÇØ„É´Êï∞„ÇíÊ±∫ÂÆö
                let count = 0;
                let goldRatio = 0;

                if (rarity === 'common') {
                    count = 30;
                    goldRatio = 0.1;
                } else if (rarity === 'rare') {
                    count = 60;
                    goldRatio = 0.3;
                } else if (rarity === 'epic') {
                    count = 100;
                    goldRatio = 0.5;
                } else if (rarity === 'legendary') {
                    count = 150;
                    goldRatio = 0.7;
                } else if (rarity === 'mythic') {
                    count = 250;
                    goldRatio = 0.9;
                }

                const centerX = window.innerWidth / 2;
                const centerY = window.innerHeight / 2;

                const newParticles = [];
                for (let i = 0; i < count; i++) {
                    const isGold = Math.random() < goldRatio;
                    const fromLeft = i % 2 === 0;

                    // Â∑¶‰∏ã„Åæ„Åü„ÅØÂè≥‰∏ã„Åã„Çâ„ÅÆÁô∫Â∞Ñ‰ΩçÁΩÆ
                    const startX = fromLeft ? '5%' : '95%';
                    const startY = '5%';

                    // ‰∏≠Â§Æ‰ªòËøë„Å∏„ÅÆ„É©„É≥„ÉÄ„É†„Å™ÁùÄÂú∞ÁÇπ
                    const spreadX = (Math.random() - 0.5) * 400;
                    const spreadY = (Math.random() - 0.5) * 400;
                    const targetX = `${centerX + spreadX}px`;
                    const targetY = `${centerY + spreadY}px`;

                    newParticles.push({
                        id: i,
                        startX,
                        startY,
                        targetX,
                        targetY,
                        color: isGold ? '#FFD700' : '#C0C0C0',
                        delay: Math.random() * 0.3,
                        duration: 0.8 + Math.random() * 0.4,
                        size: 10 + Math.random() * 8,
                    });
                }

                setParticles(newParticles);

                // 2.5ÁßíÂæå„Å´„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
                const timeout = setTimeout(() => setParticles([]), 3000);
                return () => clearTimeout(timeout);
            }, [rarity]);

            return (
                <>
                    {particles.map(p => (
                        <CrackerConfettiParticle key={p.id} {...p} />
                    ))}
                </>
            );
        };

        // --- ÂÆùÁÆ±„É¢„Éº„ÉÄ„É´ÔºàÈáçÂéöÈÄ£Êâì„Éª„Éâ„Éº„Éë„Éü„É≥„Éè„ÉÉ„ÇØÁâàÔºâ ---
        const ChestModal = ({ onClose, onReward, onStartFocus, isWakeupChest = false }) => {
            const [state, setState] = useState('idle'); // idle, locked, whiteout, opened
            const [reward, setReward] = useState(null);
            
            // ÈÄ£Êâì„Ç∑„Çπ„ÉÜ„É†Áî®„Çπ„ÉÜ„Éº„Éà
            const [tapData, setTapData] = useState({ current: 0, required: 15, progress: 0 });
            const [shakeIntensity, setShakeIntensity] = useState(0);
            const [isNearMissSlow, setIsNearMissSlow] = useState(false);
            
            // Â†±ÈÖ¨„É´„Éº„É¨„ÉÉ„ÉàÁî®
            const [rouletteSymbols, setRouletteSymbols] = useState([]);
            const [rouletteIndex, setRouletteIndex] = useState(0);

            // „É´„Éº„É¨„ÉÉ„Éà„Ç∑„É≥„Éú„É´ÂÆöÁæ©
            const allSymbols = [
                { rarity: 'common', text: 'üíé 15 Gems', color: 'text-gray-400' },
                { rarity: 'rare', text: 'üíé 50 Gems!', color: 'text-cyan-400' },
                { rarity: 'epic', text: 'üíé 120 Gems!!', color: 'text-purple-400' },
                { rarity: 'legendary', text: 'üíé 300 Gems!!!', color: 'text-yellow-400' },
                { rarity: 'mythic', text: 'üíé 777 JACKPOT', color: 'text-red-500' },
            ];

            // Â†±ÈÖ¨Ê±∫ÂÆö„É≠„Ç∏„ÉÉ„ÇØÔºàÁ¢∫ÁéáË®àÁÆóÔºâ
            const determineReward = () => {
                const roll = Math.random() * 100;
                let result = {};
                if (roll < 40) result = { type: 'gems', amount: 15, text: 'üíé 15 Gems', icon: Icons.Gem, rarity: 'common', rarityText: 'COMMON' };
                else if (roll < 70) result = { type: 'gems', amount: 50, text: 'üíé 50 Gems!', icon: Icons.Gem, rarity: 'rare', rarityText: 'RARE' };
                else if (roll < 88) result = { type: 'gems', amount: 120, text: 'üíé 120 Gems!!', icon: Icons.Gem, rarity: 'epic', rarityText: 'EPIC' };
                else if (roll < 97) result = { type: 'gems', amount: 300, text: 'üíé 300 Gems!!!', icon: Icons.Gem, rarity: 'legendary', rarityText: 'LEGENDARY' };
                else result = { type: 'gems', amount: 777, text: 'üíé 777 JACKPOT', icon: Icons.Gem, rarity: 'mythic', rarityText: 'MYTHIC' };
                return result;
            };

            // „Çø„ÉÉ„Éó„Éè„É≥„Éâ„É©„ÉºÔºà‰∏≠Ê†∏„É≠„Ç∏„ÉÉ„ÇØÔºâ
            const handleTap = async () => {
                // Êó¢„Å´ÂÆå‰∫Ü„ÅÇ„Çã„ÅÑ„ÅØÊºîÂá∫‰∏≠„ÅØÁÑ°Ë¶ñ
                if (state === 'whiteout' || state === 'opened') return;

                // „Éï„Çß„Éº„Ç∫1: ÂàùÂõû„Çø„ÉÉ„ÉóÊôÇ„ÅÆÈÅãÂëΩÂàÜÂ≤ê (50%„Åß„É≠„ÉÉ„ÇØ)
                if (state === 'idle') {
                    const isLocked = Math.random() < 0.5;
                    
                    if (isLocked) {
                        // „É≠„ÉÉ„ÇØ„É¢„Éº„Éâ„Å∏ÁßªË°åÔºàÈáçÂéö„Å™ÈáëÂ±ûÈü≥Ôºâ
                        setState('locked');
                        const required = 10 + Math.floor(Math.random() * 6); // 10-15Âõû
                        setTapData({ current: 0, required, progress: 0 });
                        
                        // „Ç¨„Ç≠„É≥ÔºÅ„Å®„ÅÑ„ÅÜÈáç„ÅÑ„É≠„ÉÉ„ÇØÈü≥
                        AudioEngine.play([150, 100], 'sawtooth', 0.4, 0.1);
                        AudioEngine.play([50], 'square', 0.5, 0.2); // Èáç‰ΩéÈü≥
                        return;
                    } else {
                        // Âç≥ÈñãÊîæÔºà„É©„ÉÉ„Ç≠„Éº„Éë„Çø„Éº„É≥Ôºâ
                        triggerOpenSequence();
                        return;
                    }
                }

                // „Éï„Çß„Éº„Ç∫2: Âä†ÈÄüÈÄ£Êâì (Mashing)
                if (state === 'locked') {
                    const newCurrent = tapData.curr

